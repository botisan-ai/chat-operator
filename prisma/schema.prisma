generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RasaHelperServer {
  id            Int          @id @default(autoincrement())
  name          String       @db.VarChar
  dockerOptions String
  createdAt     DateTime     @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime     @default(now()) @db.Timestamptz(6)
  botId         Int?
  rasa_server   RasaServer? @relation(fields: [botId], references: [id])
}

model RasaServer {
  id                 Int                  @id @default(autoincrement())
  name               String               @unique @db.VarChar
  dockerOptions      Json?
  host               String?              @db.VarChar
  port               Int
  isActive           Boolean              @default(false)
  createdAt          DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt          DateTime             @default(now()) @db.Timestamptz(6)
  helpers RasaHelperServer[]
}

model Route {
  id              Int                        @id @default(autoincrement())
  sourceType      RouteType
  sourceName      String                     @db.VarChar
  destinationType RouteType
  destinationName String                     @db.VarChar
  isActive        Boolean                    @default(false)
  createdAt       DateTime                   @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime                   @default(now()) @db.Timestamptz(6)

  @@unique([sourceType, sourceName, destinationType, destinationName])
  @@index([destinationName])
  @@index([sourceName])
  @@index([isActive])
  @@index([sourceType])
  @@index([destinationType])
}

model WechatApp {
  id        Int      @id @default(autoincrement())
  name      String   @unique @db.VarChar
  appId     String   @db.VarChar
  appSecret String   @db.VarChar
  token     String?  @db.VarChar
  aesKey    String?  @db.VarChar
  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @db.Timestamptz(6)
}

enum RouteType {
  Rasa
  WechatApp
  Wechaty
  Saga
}
